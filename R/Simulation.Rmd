---
title: "Simulation"
author: "Ze Yu Zhong"
date: "21 March 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(glmnet)
library(tidyverse)
library(keras)
library(ggplot2)
```

```{r}
#Simulation
N <- 200
P_c <- 100

#Errors
epsilon <- c(rnorm(N, 0, 1))
w <- c(rnorm(N, 0, 1))
#sigma2 <- 
```



```{r}
#characteristics C


elm <- matrix(
  data = 0, nrow = N, ncol = P_c
)

C_bar_t <- rep(list(elm), 181)

for (t in 1:180) {
  for (j in 1:P_c) {
    rho <- runif(1, 1/2, 1)
    for (i in 1:N) {
      C_bar_t[[t+1]][i, j] <- C_bar_t[[t]][i, j]*rho + rnorm(1, 0, 1)
    }
  }  
}

#Remove initial

C_bar_t[[1]] <- NULL

#B and lambda matrix
Lambda <- matrix(
  data = rnorm(N*4, 0, 1),
  nrow = N, ncol = 4
)

B <- (Lambda)%*%t(Lambda)
B <- B + 1/10*diag(nrow = nrow(B))

#Transform into correlation matrix W
W <- diag(B)^(-1/2)*B*diag(B)^(-1/2)

C_hat <- rep(list(elm), 180)

for (t in 1:180) {
  C_hat[[t]] <- W %*% C_bar_t[[t]]
}

```

```{r}

#Ct "observed characteristics"
#Done in terms of for loops, does work but is insanely slow

Ct <- rep(list(elm), 180)

for (t in 1:180) {
  Ct[[t]] <- (2/(N+1))*matrix(rank(C_bar_t[[t]], ties.method = "average"), 
                    nrow = N, ncol = P_c) - matrix(rep(1, N*P_c), nrow = N, ncol = P_c)
}
```

```{r}
#xt
A1 <- matrix(c(
  0.95, 0, 0,
  0, 0.95, 0,
  0, 0, 0.95),
  nrow = 3, ncol = 3
)

A2 <- matrix(c(
  1, 0, 0.25,
  0, 0.95, 0,
  0.25, 0, 0.95),
  nrow = 3, ncol = 3
)

A3 <- matrix(c(
  0.99, 0.2, 0.1,
  0.2, 0.90, -0.3,
  0.1, -0.3, -0.99),
  nrow = 3, ncol = 3
)

xt <- data.frame(x1 = c(0:179),
                 x2 = c(0:179),
                 x3 = c(0:179)
)

for (i in 1:179) {
  ut <- rnorm(3, mean = 0, sd = 1)
  xt[1+i,] <- A1*xt[i,] + ut
}

xt_tidy <- cbind(t = c(1:180), xt)

xt_tidy <- xt_tidy %>%
  gather(series, value, -t)
  

ggplot(data = xt_tidy) +
  geom_line(aes(x = t, y = value, colour = series))
```


```{r}
#Different g() functions

#g1
g1 <- function(C, x, i, t){
  theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
  matrix(C[[t]][i,1], C[[t]][i,2], crossprod(C[[t]][i,3], t(x[t,])), nrow = 1) %*% theta
}

g1(Ct, xt, 1, 1)

#g2
g1 <- function(C, x, i, t){
  theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
  crossprod(C[[t]][i,1:3], x[t,]) %*% theta
}

#g3
g1 <- function(C, x, i, t){
  theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
  crossprod(C[[t]][i,1:3], x[t,]) %*% theta
}

#g4

g1 <- function(C, x, i, t){
  theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
  crossprod(C[[t]][i,1:3], x[t,]) %*% theta
}

```

```{r}
#OLS

```

```{r}
#Elasticnet


```

```{r}
#Random Forest

```

```{r}
#Neural Network

```

