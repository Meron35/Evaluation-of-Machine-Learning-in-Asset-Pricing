"0","###################"
"0","##characteristics C_bar"
"0","###################"
"0","#######"
"0","##Function to Generate C_bar"
"0","#######"
"0","gen_C_bar <- function(){"
"0","  #empty matrix"
"0","  elm <- matrix("
"0","    data = 0, nrow = N, ncol = P_c"
"0","  )"
"0","  "
"0","  C_bar <- rep(list(elm), Time + 2)"
"0","  "
"0","  for (t in 1:(Time+1)) {"
"0","    for (j in 1:P_c) {"
"0","      rho <- runif(1, 1/2, 1)"
"0","      C_bar[[t+1]][, j] <- (C_bar[[t]][, j]*rho + rnorm(N, 0, 1))"
"0","    }  "
"0","  }"
"0","  "
"0","  ##Delete first period full of zeroes"
"0","  C_bar[[1]] <- NULL"
"0","  "
"0","  return(C_bar)"
"0","}"
"0","######################"
"0","##B and lambda matrix"
"0","######################"
"0","gen_B <- function(){"
"0","  Lambda <- matrix("
"0","    data = rnorm(N*4, 0, 1),"
"0","    nrow = N, ncol = 4"
"0","  )"
"0","  "
"0","  B <- (Lambda) %*% t(Lambda)"
"0","  B <- B + 1/10*diag(nrow = nrow(B))"
"0","  "
"0","  return(B)"
"0","}"
"0","#######################################"
"0","##Transform into correlation matrix W"
"0","#######################################"
"0","gen_W <- function(){"
"0","  W <- diag(B)^(-1/2)*B*diag(B)^(-1/2)"
"0","  return(W)"
"0","}"
"0","#########################"
"0","##Generate C_hat"
"0","#########################"
"0","#Generation of C hat requires generating B and W first"
"0","gen_C_hat <- function(){"
"0","  B <- gen_B()"
"0","  W <- gen_W()"
"0","  "
"0","  C_hat <- rep(list(elm), Time + 1)"
"0","  for (t in 1:(Time+1)) {"
"0","    C_hat[[t]] <- W %*% C_bar[[t]]"
"0","  }"
"0","  "
"0","  return(C_hat)"
"0","}"
"0","##################################"
"0","##Generate final ""observed"" C"
"0","##################################"
"0","#Remember you need to generate C_bar first"
"0","gen_C <- function(){"
"0","  C <- rep(list(elm), Time+1)"
"0","  for (t in 1:(Time+1)) {"
"0","    C[[t]] <- (2/(N*P_c+1))*"
"0","      matrix(rank(C_bar[[t]]), nrow = N, ncol = P_c) - matrix("
"0","        data = 1, nrow = N, ncol = P_c"
"0","        )"
"0","  }"
"0","  "
"0","  return(C)"
"0","}"
