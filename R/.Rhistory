C_hat <- rep(list(elm), 180)
for (t in 1:180) {
C_hat[[t]] <- W %*% C_bar_t[[t]]
}
#Final proper C
C <- rep(list(elm), 180)
for (t in 1:1) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- 2/(N+1)*matrix(
rank(C_bar_t[[t]]),
nrow = N, ncol = P_c
)[i, j] - 1
}
}
}
View(Ct)
Ct <- rep(list(elm), 180)
for (t in 1:) {
for (t in 1:180) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- 2/(N+1)*matrix(
rank(C_bar_t[[t]]),
nrow = N, ncol = P_c
)[i, j] - 1
}
}
}
#Simulation
N <- 200
P_c <- 100
#Errors
epsilon <- c(rnorm(N, 0, 1))
w <- c(rnorm(N, 0, 1))
#sigma2 <-
#characteristics C
elm <- matrix(
data = 0, nrow = N, ncol = P_c
)
C_bar_t <- rep(list(elm), 181)
for (t in 1:180) {
for (j in 1:P_c) {
rho <- runif(1, 1/2, 1)
for (i in 1:N) {
C_bar_t[[t+1]][i, j] <- C_bar_t[[t]][i, j]*rho + rnorm(1, 0, 1)
}
}
}
#Remove initial
C_bar_t[[1]] <- NULL
#B and lambda matrix
Lambda <- matrix(
data = rnorm(N*4, 0, 1),
nrow = N, ncol = 4
)
B <- (Lambda)%*%t(Lambda)
B <- B + 1/10*diag(nrow = nrow(B))
#Transform into correlation matrix W
W <- diag(B)^(-1/2)*B*diag(B)^(-1/2)
C_hat <- rep(list(elm), 180)
for (t in 1:180) {
C_hat[[t]] <- W %*% C_bar_t[[t]]
}
#Final proper C
Ct <- rep(list(elm), 180)
for (t in 1:180) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- 2/(N+1)*matrix(
rank(C_bar_t[[t]], ties.method = "average"),
nrow = N, ncol = P_c
)[i, j] - 1
}
}
}
Ct[[1]]
Ct <- rep(list(elm), 180)
for (t in 1:2) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- 2/(N+1)*matrix(
rank(C_bar_t[[t]], ties.method = "average"),
nrow = N, ncol = P_c
)[i, j] - 1
}
}
}
Ct[[1]]
Ct[[2]]
Ct <- lapply(C_bar_t,
for (j in 1:P_c) {
for (i in 1:N) {
2/(N+1)*matrix(
rank(C_bar_t, ties.method = "average"),
nrow = N, ncol = P_c
)[i, j] - 1
}
}
)
Ct <- lapply(C_bar_t,
for (j in 1:P_c) {
for (i in 1:N) {
2/(N+1)*matrix(
rank(C_bar_t[[]], ties.method = "average"),
nrow = N, ncol = P_c
)[i, j] - 1
}
}
)
Ct <- rep(list(elm), 180)
for (t in 1:180) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- 2/(N+1)*(
rank(C_bar_t[[t]], ties.method = "average")
)[(i-1)*j + j] - 1
}
}
}
Ct <- rep(list(elm), 180)
for (t in 1:180) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- (
rank(C_bar_t[[t]], ties.method = "average")
)[(i-1)*j + j]
}
}
}
Ct <- rep(list(elm), 180)
for (t in 1:2) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <- (
rank(C_bar_t[[t]], ties.method = "average")
)[(i-1)*j + j]
}
}
}
Ct[[2]]
rank(C_bar_t[[1]]
)
Ct <- rep(list(elm), 180)
for (t in 1:2) {
for (j in 1:P_c) {
for (i in 1:N) {
Ct[[t]][i, j] <-
matrix(rank(C_bar_t[[t]], ties.method = "average"),
nrow = N, ncol = P_c)
}
}
}
for (t in 1:180) {
Ct[[t]] <- matrix(rank(C_bar_t[[t]], ties.method = "average"),
nrow = N, ncol = P_c)
}
View(Ct)
Ct[[3]]
View(Ct)
for (t in 1:180) {
Ct[[t]] <- (2/(N+1))*matrix(rank(C_bar_t[[t]], ties.method = "average"),
nrow = N, ncol = P_c) - matrix(rep(1, N*P_c), nrow = N, ncol = P_c)
}
View(Ct)
#xt
A1 <- matrix(c(
0.95, 0, 0,
0, 0.95, 0,
0, 0, 0.95),
nrow = 3, ncol = 3
)
A2 <- matrix(c(
1, 0, 0.25,
0, 0.95, 0,
0.25, 0, 0.95),
nrow = 3, ncol = 3
)
A3 <- matrix(c(
0.99, 0.2, 0.1,
0.2, 0.90, -0.3,
0.1, -0.3, -0.99),
nrow = 3, ncol = 3
)
xt <- data.frame(x1 = c(0:179),
x2 = c(0:179),
x3 = c(0:179)
)
for (i in 1:179) {
ut <- rnorm(3, mean = 0, sd = 1)
xt[1+i,] <- A1*xt[i,] + ut
}
xt_tidy <- cbind(t = c(1:180), xt)
xt_tidy <- xt_tidy %>%
gather(series, value, -t)
ggplot(data = xt_tidy) +
geom_line(aes(x = t, y = value, colour = series))
#g1
g1 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
crossprod(C[[t]][i,1:3], x[t,]) %*% theta
}
g1(Ct, xt, 1, 1)
#g1
g1 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
C[[t]][i,1:3] %*% x[t,] %*% theta
}
g1(Ct, xt, 1, 1)
xt[t,]
C[[1]][i,1:3]
C[[1]][1,1:3]
Ct[[1]][1,1:3]
#g1
g1 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
C[[t]][i,1:3] %*% t(x[t,]) %*% theta
}
g1(Ct, xt, 1, 1)
C[[1]][1,1:3] %*% t(x[1,])
C[[1]][1,1:3] %*% t(xt[1,])
Ct[[1]][1,1:3] %*% t(xt[1,])
#g1
g1 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
matrix(C[[t]][i,1], C[[t]][i,2], C[[t]][i,3] %*% t(x[t,]), nrow = 1) %*% theta
}
g1(Ct, xt, 1, 1)
?crossprod
crossprod(Ct[[1]][1,3], t(x[1,]))
crossprod(Ct[[1]][1,3], t(xt[1,]))
knitr::opts_chunk$set(echo = TRUE)
library(glmnet)
library(tidyverse)
library(keras)
library(ggplot2)
#Simulation
N <- 200
P_c <- 100
#Errors
epsilon <- c(rnorm(N, 0, 1))
w <- c(rnorm(N, 0, 1))
#sigma2 <-
#characteristics C
elm <- matrix(
data = 0, nrow = N, ncol = P_c
)
C_bar <- rep(list(elm), 181)
for (t in 1:180) {
for (j in 1:P_c) {
rho <- runif(1, 1/2, 1)
for (i in 1:N) {
C_bar[[t+1]][i, j] <- C_bar[[t]][i, j]*rho + rnorm(1, 0, 1)
}
}
}
#Remove initial
C_bar[[1]] <- NULL
#B and lambda matrix
Lambda <- matrix(
data = rnorm(N*4, 0, 1),
nrow = N, ncol = 4
)
B <- (Lambda)%*%t(Lambda)
B <- B + 1/10*diag(nrow = nrow(B))
#Transform into correlation matrix W
W <- diag(B)^(-1/2)*B*diag(B)^(-1/2)
C_hat <- rep(list(elm), 180)
for (t in 1:180) {
C_hat[[t]] <- W %*% C_bar[[t]]
}
#Generate final "observed" C
C <- rep(list(elm), 180)
for (t in 1:180) {
C[[t]] <- (2/(N*P_c+1))*(
rank(C_bar[[t]])
) - matrix(
data = 1, nrow = N, ncol = P_c
)
}
#xt
A1 <- matrix(c(
0.95, 0, 0,
0, 0.95, 0,
0, 0, 0.95),
nrow = 3, ncol = 3
)
A2 <- matrix(c(
1, 0, 0.25,
0, 0.95, 0,
0.25, 0, 0.95),
nrow = 3, ncol = 3
)
A3 <- matrix(c(
0.99, 0.2, 0.1,
0.2, 0.90, -0.3,
0.1, -0.3, -0.99),
nrow = 3, ncol = 3
)
xt <- data.frame(x1 = c(0:179),
x2 = c(0:179),
x3 = c(0:179)
)
gen_xt <- function(A, xt){
for (i in 1:179) {
ut <- rnorm(3, mean = 0, sd = 1)
xt[1+i,] <- A*xt[i,] + ut
}
}
plot_xt <- function(xt){
xt_tidy <- cbind(t = c(1:180), xt)
xt_tidy <- xt_tidy %>%
gather(series, value, -t)
ggplot(data = xt_tidy) +
geom_line(aes(x = t, y = value, colour = series))
}
#Different g() functions
logit <- function(x){
(1 + exp(-x))^(-1)
}
#g1
g1 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
matrix(c(
C[[t]][i,1], C[[t]][i,2], C[[t]][i,3] * t(x[t, 1])
), nrow = 1) %*% theta
}
g1(C, xt, 1, 1)
#g2
g2 <- function(C, x, i, t){
theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
matrix(c(
C[[t]][i, 1]crossprod(C[[t]][i,1:3], x[t, 1]) %*% theta
?sign
matrix(c(
C[[t]][i,1], C[[t]][i,2], C[[t]][i,3] * t(x[t, 3])
), nrow = 1) %*% theta
#g1
g1 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
matrix(c(
C[[t]][i,1], C[[t]][i,2], C[[t]][i,3] * t(x[t, 3])
), nrow = 1) %*% theta
}
g1(C, xt, 1, 1)
#g2
g2 <- function(C, x, i, t){
theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
matrix(c(
C[[t]][i, 1]^2,
C[[t]][i, 1]*C[[t]][i, 2],
sign(C[[t]][i, 3] * t(x[t, 3])),
), nrow = 1) %*% theta
}
g2(C, xt, 1, 1)
#g2
g2 <- function(C, x, i, t){
theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
matrix(c(
C[[t]][i, 1]^2,
C[[t]][i, 1]*C[[t]][i, 2],
sign(C[[t]][i, 3] * t(x[t, 3])),
), nrow = 1) %*% theta
}
g2(C, xt, 1, 1)
#g2
g2 <- function(C, x, i, t){
theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
matrix(c(
C[[t]][i, 1]^2,
C[[t]][i, 1]*C[[t]][i, 2],
sign(
C[[t]][i, 3] * t(x[t, 3])
),
), nrow = 1) %*% theta
}
g2(C, xt, 1, 1)
#g2
g2 <- function(C, x, i, t){
theta <- matrix(c(0.04, 0.035, 0.01), ncol = 1)
matrix(c(
C[[t]][i, 1]^2,
C[[t]][i, 1]*C[[t]][i, 2],
sign(
C[[t]][i, 3] * t(x[t, 3])
)
), nrow = 1) %*% theta
}
g2(C, xt, 1, 1)
g4(C, xt, 1, 1)
g4 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
crossprod(C[[t]][i,1:3], x[t,]) %*% theta
}
g4(C, xt, 1, 1)
g4 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
matrix(c(
Chat[[t]][i, 1],
Chat[[t]][i, 2],
Chat[[t]][i, 3]*t(x[t, 3])
), nrow = 1
)
%*% theta
g4 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
matrix(c(
Chat[[t]][i, 1],
Chat[[t]][i, 2],
Chat[[t]][i, 3]*t(x[t, 3])
), nrow = 1
) %*% theta
}
g4(C, xt, 1, 1)
#g4
#Remember that we are supposed to pass C hat through to g4
g4 <- function(C, x, i, t){
theta <- matrix(c(0.02, 0.02, 0.02), ncol = 1)
matrix(c(
C[[t]][i, 1],
C[[t]][i, 2],
C[[t]][i, 3]*t(x[t, 3])
), nrow = 1
) %*% theta
}
g4(C_hat, xt, 1, 1)
omega <- -0.736
gamma <- 0.90
w <- sqrt(0.363)
##Beta, i,t
eln <- matrix(0, nrow = N, ncol = 3)
Beta <- rep(list(eln), 181)
Beta <- rep(list(eln), 180)
for (t in 1:180) {
B[[t]] <- C[[t]][, 1:3]
}
C[[t]][, 1:3]
for (t in 1:180) {
B[[t]] <- C[[t]][, 1:3]
}
##Beta, i,t
eln <- matrix(0, nrow = N, ncol = 3)
Beta <- rep(list(eln), 180)
for (t in 1:180) {
B[[t]] <- C[[t]][, 1:3]
}
View(Ct)
View(Ct)
View(C)
for (t in 1:180) {
Beta[[t]] <- C[[t]][, 1:3]
}
gen_xt <- function(A, xt){
Axt <- xt
for (i in 1:179) {
ut <- rnorm(3, mean = 0, sd = 1)
Axt[1+i,] <- Axt[i,] + ut
}
return(Axt)
}
gen_xt(A1, xt)
##############################
##A1
##############################
A1xt <- gen_xt(A1, xt)
A2xt <- gen_xt(A2, xt)
A3xt <- gen_xt(A3, xt)
v <- matrix(
data = rnorm(3, 0, 1), nrow = 3, ncol = 1
)
elo <- matrix(0, nrow = 3, ncol = 1)
v <- rep(elo, 180)
v <- rep(list(elo), 180)
v <- rep(list(elo), 180)
for (t in 1:180) {
v[[t]] <- matrix(
data = rnorm(3, 0, 1),
nrow = 3, ncol = 1
)
}
View(v)
sigma2 <- rep(list(0), 181)
sigma[[1]]
sigma2[[1]]
sigma2[[1]] <- omega + w
sigma2 <- rep(list(0), 181)
sigma2[[1]] <- omega + w
for (t in 1:180) {
sigma2[[t+1]] <- omega + gamma*sigma2[[t]] + w
}
sigma2[[1]] <- NULL
View(sigma2)
error <- rep(
list(
matrix(
0, nrow = N, ncol = 1
)
), 180
)
for (t in 1:180){
for (i in 1:200) {
error[[t]][i] <- exp(sigma2[[t]]/2)*rnorm(1, 0, 1)
}
}
View(error)
View(error)
?sqrt
for (t in 1:180){
for (i in 1:200) {
error[[t]][i] <- exp(sqrt(sigma2[[t]])/2)*rnorm(1, 0, 1)
}
}
